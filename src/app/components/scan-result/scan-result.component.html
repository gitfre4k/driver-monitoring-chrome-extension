<div class="scan-results">
  <h3 class="scan-results__title">Scan Results</h3>
  @if (driverCount(); as driverCount) {
  <span style="margin-bottom: 12px">Active Drivers: {{ driverCount }}</span>
  }
  <div class="scan-results__content">
    <mat-accordion>
      <mat-expansion-panel style="margin-bottom: 8px">
        <mat-expansion-panel-header>
          <mat-panel-title> Violations </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (violations.length < 0) {
          <span>No violations.</span>
          <mat-divider></mat-divider>
          } @else { @for (violation of violations; track violation.company) {
          <h3># {{ violation.company }}</h3>

          @for (item of violation.violations.items; track item.id) {
          <div class="driver">
            <a
              mat-icon-button
              (click)="copyDriverName(item.driverName)"
              matTooltip="Copy to clipboard"
            >
              <mat-icon>content_copy</mat-icon>
            </a>
            <span>{{ item.driverName }}</span>
          </div>

          <ul>
            @for (v of item.violations; track v.violationId){
            <li>
              <span>{{ v.type }}</span>
            </li>
            }
          </ul>
          }
          <mat-divider></mat-divider>
          } }
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <!--  -->
    <!--  -->
    <!--  -->
    <mat-accordion>
      <!--  -->
      <!-- Teleports -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> Teleports </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.teleports)) {
          <span>No teleports.</span>
          <mat-divider></mat-divider>
          } @else {
          <ul>
            @for (teleport of scanResults.teleports | keyvalue; track
            teleport.key) {
            <li>
              <h3>{{ teleport.key }}</h3>
              @for (driver of teleport.value; track driver.id) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver.driverName)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver.driverName }}</span>
              </div>
              @if (driver.event.isTeleport > 0) {
              <span>
                - teleport detected on event #{{ driver.event.viewId }}
                {{ driver.event.statusName }} [
                {{ driver.event.isTeleport }} miles ]
              </span>
              } @else {
              <span>
                - odometer decreased on event #{{ driver.event.viewId }}
                {{ driver.event.statusName }}
              </span>
              } }
            </li>
            }
          </ul>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- event Errors -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> event Errors</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.eventErrors)) {
          <span>No event errors.</span>
          <mat-divider></mat-divider>
          } @else {
          <ul>
            @for (eventError of scanResults.eventErrors | keyvalue; track
            eventError.key) {
            <li>
              <h3>{{ eventError.key }}</h3>
              @for (driver of eventError.value; track driver.id) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver.driverName)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver.driverName }}</span>
              </div>
              <span>
                - error detected on event #{{ driver.event.viewId }}
                {{ driver.event.statusName }}: {{ driver.event.errorMessage }}
              </span>
              }
            </li>
            }
          </ul>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- prolonged OnDutuis -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> prolenged On Duties</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.prolengedOnDuties)) {
          <span>No prolonged On Duties detected.</span>

          } @else {
          <ul>
            @for (onDuty of scanResults.prolengedOnDuties | keyvalue; track
            onDuty.key) {
            <li>
              <h3>{{ onDuty.key }}</h3>
              @for (driver of onDuty.value; track driver.id) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver.driverName)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver.driverName }}</span>
              </div>
              <span>
                - prolonged On Duty detected, duration:
                {{ driver.duration * 1000 | date : "H:mm" : "UTC" }}
              </span>
              }
            </li>
            }
          </ul>

          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- Malfunction / DataDiagnostic -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> Malfunction / DataDiagnostic</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.malfOrDataDiagDetection)) {
          <span>No malfunctions or data diagnostics detected.</span>
          <mat-divider></mat-divider>
          } @else {

          <ul>
            @for (detection of scanResults.malfOrDataDiagDetection | keyvalue;
            track detection.key) {
            <li>
              <h3>{{ detection.key }}</h3>
              @for (driver of detection.value; track driver) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver }}</span>
              </div>
              <span>- malfunction or data diagnostic detected</span>
              }
            </li>
            }
          </ul>
          <mat-divider></mat-divider>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- PC/YM  -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> PC / YM </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.pcYm)) {
          <span>No PC/YM events detected.</span>
          <mat-divider></mat-divider>
          } @else {

          <ul>
            @for (detection of scanResults.pcYm | keyvalue; track detection.key)
            {
            <li>
              <h3>{{ detection.key }}</h3>
              @for (driver of detection.value; track driver) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver }}</span>
              </div>
              <span>- PC/YM event detected</span>
              }
            </li>
            }
          </ul>
          <mat-divider></mat-divider>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- missing Engine On events -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> missing Engine On </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.missingEngineOn)) {
          <span>No missing Engine On events detected.</span>
          <mat-divider></mat-divider>
          } @else {

          <ul>
            @for (detection of scanResults.missingEngineOn | keyvalue; track
            detection.key) {
            <li>
              <h3>{{ detection.key }}</h3>
              @for (driver of detection.value; track driver) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver }}</span>
              </div>
              <span>- missing Engine On detected</span>
              }
            </li>
            }
          </ul>
          <mat-divider></mat-divider>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- high elapsed Engine Hours -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> high Engine Hours</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.highEngineHours)) {
          <span>Neither high nor negative Engine Hours events detected.</span>
          <mat-divider></mat-divider>
          } @else {
          <ul>
            @for (highEngineHoursEvent of scanResults.highEngineHours |
            keyvalue; track highEngineHoursEvent.key) {
            <li>
              <h3>{{ highEngineHoursEvent.key }}</h3>
              @for (driver of highEngineHoursEvent.value; track driver.id) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver.driverName)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver.driverName }}</span>
              </div>
              <span>
                - high elapsed Engine Hours event detected, count:
                {{ driver.duration }}
              </span>
              }
            </li>
            }
          </ul>
          <mat-divider></mat-divider>
          }
        </div>
      </mat-expansion-panel>

      <!--  -->
      <!-- low total Engine Hours events -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>low Total Engine Hours</mat-panel-title>
        </mat-expansion-panel-header>
        <div class="scan-results__content__result">
          @if (isEmpty(scanResults.lowTotalEngineHours)) {
          <span>No low total Engine Hours events.</span>
          <mat-divider></mat-divider>
          } @else {

          <ul>
            @for (detection of scanResults.lowTotalEngineHours | keyvalue; track
            detection.key) {
            <li>
              <h3>{{ detection.key }}</h3>
              @for (driver of detection.value; track driver) {
              <div class="driver">
                <a
                  mat-icon-button
                  (click)="copyDriverName(driver)"
                  matTooltip="Copy to clipboard"
                >
                  <mat-icon>content_copy</mat-icon>
                </a>
                <span>{{ driver }}</span>
              </div>
              <span>- low total Engine Hours events detected</span>
              }
            </li>
            }
          </ul>
          <mat-divider></mat-divider>
          }
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
