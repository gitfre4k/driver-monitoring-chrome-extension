<div class="dialog">
  @if (advancedScanResults) {
  <div class="violation-report">
    <mat-icon>article</mat-icon>
    <h3 mat-dialog-title>Advanced Scan Results</h3>
  </div>
  <mat-dialog-content class="mat-typography">
    <!--  -->
    <!-- prolonged OnDutuis -->
    @if (isEmpty(advancedScanResults.prolengedOnDuties)) {
    <p>No prolonged On Duties detected.</p>
    <mat-divider></mat-divider>
    } @else {
    <ul>
      @for (onDuty of advancedScanResults.prolengedOnDuties | keyvalue; track
      onDuty.key) {
      <li>
        <h3>{{ onDuty.key }}</h3>
        @for (driver of onDuty.value; track driver.id) {
        <div class="driver">
          <a
            mat-icon-button
            (click)="copyDriverName(driver.driverName)"
            matTooltip="Copy to clipboard"
          >
            <mat-icon>content_copy</mat-icon>
          </a>
          <p>{{ driver.driverName }}</p>
        </div>
        <p>
          - prolonged On Duty detected, duration:
          {{ driver.duration * 1000 | date : "H:mm" : "UTC" }}
        </p>
        }
      </li>
      }
    </ul>
    <mat-divider></mat-divider>

    }
    <!--  -->
    <!-- malfunctions or data diagnostics -->
    @if (isEmpty(advancedScanResults.malfOrDataDiagDetection)) {
    <p>No malfunctions or data diagnostics detected.</p>
    <mat-divider></mat-divider>
    } @else {

    <ul>
      @for (detection of advancedScanResults.malfOrDataDiagDetection | keyvalue;
      track detection.key) {
      <li>
        <h3>{{ detection.key }}</h3>
        @for (driver of detection.value; track driver) {
        <div class="driver">
          <a
            mat-icon-button
            (click)="copyDriverName(driver)"
            matTooltip="Copy to clipboard"
          >
            <mat-icon>content_copy</mat-icon>
          </a>
          <p>{{ driver }}</p>
        </div>
        <p>- malfunction or data diagnostic detected</p>
        }
      </li>
      }
    </ul>
    <mat-divider></mat-divider>
    }
    <!--  -->
    <!-- PC/YM  -->
    @if (isEmpty(advancedScanResults.pcYm)) {
    <p>No PC/YM events detected.</p>
    <mat-divider></mat-divider>
    } @else {

    <ul>
      @for (detection of advancedScanResults.pcYm | keyvalue; track
      detection.key) {
      <li>
        <h3>{{ detection.key }}</h3>
        @for (driver of detection.value; track driver) {
        <div class="driver">
          <a
            mat-icon-button
            (click)="copyDriverName(driver)"
            matTooltip="Copy to clipboard"
          >
            <mat-icon>content_copy</mat-icon>
          </a>
          <p>{{ driver }}</p>
        </div>
        <p>- PC/YM event detected</p>
        }
      </li>
      }
    </ul>
    <mat-divider></mat-divider>
    }

    <!--  -->
    <!-- missing Engine On events -->
    @if (isEmpty(advancedScanResults.missingEngineOn)) {
    <p>No missing Engine On events detected.</p>
    <mat-divider></mat-divider>
    } @else {

    <ul>
      @for (detection of advancedScanResults.missingEngineOn | keyvalue; track
      detection.key) {
      <li>
        <h3>{{ detection.key }}</h3>
        @for (driver of detection.value; track driver) {
        <div class="driver">
          <a
            mat-icon-button
            (click)="copyDriverName(driver)"
            matTooltip="Copy to clipboard"
          >
            <mat-icon>content_copy</mat-icon>
          </a>
          <p>{{ driver }}</p>
        </div>
        <p>- missing Engine On detected</p>
        }
      </li>
      }
    </ul>
    <mat-divider></mat-divider>
    }
    <!--  -->
    <!-- high elapsed Engine Hours -->
    @if (isEmpty(advancedScanResults.highEngineHours)) {
    <p>Neither high nor negative Engine Hours events detected.</p>
    <mat-divider></mat-divider>
    } @else {
    <ul>
      @for (highEngineHoursEvent of advancedScanResults.highEngineHours |
      keyvalue; track highEngineHoursEvent.key) {
      <li>
        <h3>{{ highEngineHoursEvent.key }}</h3>
        @for (driver of highEngineHoursEvent.value; track driver.id) {
        <div class="driver">
          <a
            mat-icon-button
            (click)="copyDriverName(driver.driverName)"
            matTooltip="Copy to clipboard"
          >
            <mat-icon>content_copy</mat-icon>
          </a>
          <p>{{ driver.driverName }}</p>
        </div>
        <p>
          - high elapsed Engine Hours event detected, count:
          {{ driver.duration }}
        </p>
        }
      </li>
      }
    </ul>
    <mat-divider></mat-divider>

    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
  } @if (violations) {
  <div class="violation-report">
    <mat-icon>article</mat-icon>
    <h3 mat-dialog-title>Violations</h3>
  </div>

  @if (!violations.length) {
  <mat-dialog-content>No violations detected.</mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button mat-dialog-close>OK</button>
  </mat-dialog-actions>
  } @else {
  <mat-dialog-content class="mat-typography">
    @for (violation of violations; track violation.company) {
    <h3># {{ violation.company }}</h3>

    @for (item of violation.violations.items; track item.id) {
    <div class="driver">
      <a
        mat-icon-button
        (click)="copyDriverName(item.driverName)"
        matTooltip="Copy to clipboard"
      >
        <mat-icon>content_copy</mat-icon>
      </a>
      <p>{{ item.driverName }}</p>
    </div>

    <ul>
      @for (v of item.violations; track v.violationId){
      <li>
        <p>{{ v.type }}</p>
      </li>
      }
    </ul>
    }
    <mat-divider></mat-divider>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
  } } @if (inspections) {
  <div class="violation-report">
    <mat-icon>article</mat-icon>
    <h3 mat-dialog-title>FMCSA Inspections</h3>
  </div>

  @if (!inspections.length) {
  <mat-dialog-content>No FMCSA inspections detected.</mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button mat-dialog-close>OK</button>
  </mat-dialog-actions>
  } @else {
  <mat-dialog-content class="mat-typography">
    @for (inspection of inspections; track inspection.company) {
    <h3># {{ inspection.company }}</h3>

    @for (item of inspection.inspections.items; track item.id) {
    <div class="driver">
      <a
        mat-icon-button
        (click)="copyDriverName(item.driverFullName)"
        matTooltip="Copy to clipboard"
      >
        <mat-icon>content_copy</mat-icon>
      </a>
      <p>{{ item.driverFullName }}</p>
    </div>
    <ul>
      <li>
        <p>Vehicle ID: {{ item.vehicleName }}</p>
      </li>
      <li>
        <p>Timestamp: {{ item.time }}</p>
      </li>
      <li>
        <p>Report Type: {{ item.reportType }}</p>
      </li>
      <li>
        <p>Editable: {{ item.editable }}</p>
      </li>
      <li>
        <p>Official: {{ !item.isUnofficial }}</p>
      </li>
    </ul>
    }
    <mat-divider></mat-divider>
    }
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
  } }
</div>
